# The anatomy of a hxcpp build

Examining the parts that call and configure the hxcpp build tool.

## The hxcpp build tool

Once the c++ sources are generated by the haxe compiler the next step is to run the hxcpp build tool. The tool is typically run via `haxelib run hxcpp` with some options. The most useful option while learning about hxcpp build processes is the `-verbose` flag.

> If you're unfamiliar with haxelib (the Haxe package manager) and it's run command it simply allows a library to have a small script that can be executed to perform tasks.

hxcpp defines it's run script as a tool that can read XML files to perform a build. The nodes inside of the XML are a build file; they describe a variety of options for telling hxcpp what you want to do.

**Invoking the build directly**   
Inside the `bin/` folder of our "hello hxcpp" example there is one of these files, `Build.xml`. We can run the build directly by invoking the build tool ourselves, to do this you have to change the working directory to the `bin/` folder:

`cd ./bin/`   
`haxelib run hxcpp Build.xml`

This will run the same process that Haxe ran automatically for us, generating the executable. If you get no output from this command remember that hxcpp can tell that nothing has changed, so it has no work to do, and nothing to build. Try deleting the executable, and hxcpp will relink it when you invoke the build.

**hxcpp build defines and configuration**   
The hxcpp build tool focuses specifically on building. All configuration relates directly to the build, and is done via environment variables or, most commonly, via build defines. **Take note** that there are two types of defines when dealing with hxcpp.

The first kind is explicitly told to the hxcpp build tool `haxelib run hxcpp -Ddefine`. These only affect the hxcpp build process and the build configuration.

The second type of define is the regular Haxe compiler defines which affect the Haxe code and are earlier in the build process. These are read from the file in the Haxe compiler output folder called `Options.txt`.

>Take note that the Haxe compiler has a space, `-D define` while the hxcpp build tool does not `-Ddefine`.


## Options.txt

When Haxe generates the c++ output code it also writes a file called Options.txt alongside it. This file is read automatically by the hxcpp build tool, and contains important settings for configuring the hxcpp build. Each line within the file is one _hxcpp_ define.

When you define a Haxe compiler define, it is _forwarded_ to hxcpp  via `Options.txt`. For example, in the intro "hello hxcpp" example you will find the `Options.txt` contains something along these lines:

```
haxe3=1
haxe_ver=3.201
hxcpp_api_level=321
hxcpp=(...)/hxcpp/3,2,205/
```

>Note that the `(...)` is the path to haxelib, shortened for clarity.

However, if we added a define to the Haxe compiler,

`haxe -main Example -cpp bin/ -D my-define`

The file contents changes to the following:

```
haxe3=1
haxe_ver=3.201
hxcpp_api_level=321
my-define=1
my_define=1
hxcpp=(...)/hxcpp/3,2,205/
```

> You should notice a property of Haxe defines above. When a define contains a `-` hyphen or a `_` underscore, the define is automatically added with both a hyphen _and_ an underscore, making them interchangeable for convenience.

You can also see that there are other defines from the Haxe compiler that we didn't define, and there is one define per line.

Some of these are important configuration for the hxcpp build to coordinate with the Haxe compile stage. For instance, `hxcpp_api_level` is used to handle backward compatibility, so that the latest version of hxcpp can run on older versions of the Haxe compiler - by implementing the correct code for the right API level that the current Haxe compiler implements.

Keep in mind that these are now hxcpp defines (they are no longer Haxe compiler defines) and would be equivalent to typing the following out on the command line out manually:

`haxelib run hxcpp -Dhaxe3=1 -Dhaxe_ver=3.201 -Dhxcpp_api_level=321 -Dmy-define=1 -Dmy_define=1 -Dhxcpp={haxelib}/hxcpp/3,2,205/`

## Build configuration

Let's put this information to use, and change the executable name. The default name is set to the `-main` class - we can rename it using the define called `HAXE_OUTPUT_FILE`.

> Note that the `HAXE_OUTPUT_FILE` define does not work as intended in hxcpp versions prior to 3.2.170. The later versions allow even finer grained control over the output name.

From inside the `bin/` folder like before, we can run hxcpp explicitly giving it the define:

`haxelib run hxcpp Build.xml -DHAXE_OUTPUT_FILE=App`

The build will now generate a new executable under the new name. Because of the `Options.txt` forwarding the defines from the Haxe compiler stage, we can also define this at the Haxe compilation stage.

`haxe -main Example -cpp bin/ -D HAXE_OUTPUT_FILE=App`

## .hxcpp_config.xml

One final important factor to mention is the user specific hxcpp config file located in your user home folder of your OS. On windows this would be `C:\windows\USER\.hxcpp_config.xml`, on mac `/Users/USER/.hxcpp_config.xml` and unix `/home/USER/.hxcpp_config.xml`.

This file contains important default configuration that hxcpp generates and stores for itself, and gives you a place to configure hxcpp globally for all builds. It usually has comments in it with some examples as well as a number of _sane defaults_ for configuring the many build toolchains of various platforms.

For now, most of the information in this file won't matter - but understanding that it exists and what it's purpose is will help you master the hxcpp build tool.

Our next step is diving into the XML format.

---
